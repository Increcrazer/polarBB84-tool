# PBB84analysis
## 基本功能
用于进行偏振调制BB84量子光源的性能测试，具有以下特性：
- 一键操作：用户仅需按下“确定”键即可以看到量子光源性能参数
- 分为治之：每个维度的性能都开一个面板，追求实用

## 用户输入参数
每个面板的用户输入参数定义相同
- 数据名称
    - LD面板：用户输入xx，读取LD-xx.csv文件
    - SDV面板：用户输入xx，读取SDV-xx.csv文件
    - PNRL面板：用户输入xx，读取CH1-xx.csv~CH4-xx.csv文件
    - SDVPNRL面板：用户输入xx，读取CH1-xx.csv~CH4-xx.csv文件
- 频率：系统重频
- 寻峰间距：由系统重频和TDC采样bin宽决定，一般取0.9*T/bin width。例如，对于1.25G重频，bin width为16 ps时，取寻峰间距为45
- 门宽：模拟实际实验时的门宽内采样，用于计算门宽对比度等。对于SDV面板和PNRL面板，可以手动输入或自动寻优
- 阈值：设置强度判定门限，例如设置“S态阈值”为1000,则判定所有峰值计数>1000的脉冲都是S态。当没有找到符合阈值的脉冲时，Matlab会自动报错，此时只要尝试重新输入合理阈值即可
- 延时：将指定通道数据进行人为延时
- 效率：对于偏振态性能测试相当重要，输入探测端的效率，即可准确求解对比度、PDL等参数

另外，用户还可以自定义图像横坐标范围以及纵坐标对数/线性显示。仅需拖动滑块，勾选数/线性显示按钮，再按“确定”键即可。

## 各面板功能
### LD面板
- 脉冲宽度测量功能：脉冲3dB宽度和20dB宽度，都是平均值
- 测量频率和标准差：脉冲频率和标准差

典型处理结果如下：
![](https://s2.loli.net/2025/12/28/39EwlyDLz4Ocubj.png)

### SDV面板
- 脉冲宽度测量功能：各种脉冲3dB宽度和20dB宽度，都是平均值
- 上升（下降）时间测量功能：10dB宽度和0.46dB宽度对应90%和10%宽度，可用于计算10%~90%上升时间
- 变异系数：定义为标准差/平均值，用来衡量脉冲峰值强度稳定性
- 对比度测量功能：包括S/D和S/V的峰值对比度以及门宽对比度测量
- 最优门宽寻找：自动寻找对比度最高时对应的门宽，门宽扫描结果在门宽分析面板中:
    ![](https://s2.loli.net/2025/12/28/nzXRmjpub8BNYLM.png)
典型处理结果如下：

![](https://s2.loli.net/2025/12/28/NDcuoJghBpCFKev.png)

### PNRL面板
CH1-CH4通道分别对应PNRL测量基，用户应遵循该定义进行数据采集。
- 脉冲宽度测量功能：各种脉冲3dB宽度和20dB宽度，都是平均值
- 变异系数：定义为标准差/平均值，用来衡量脉冲峰值强度稳定性，主通道和次通道表示和偏振态对应和正交的通道
- 对比度、误码率：包括峰值、门宽对比度和误码率的平均值
- PDL：求解每种偏振态门宽内计数平均值，然后找到其中的最大值max和最小值min，计算10log10(max/min)
- 最优门宽寻找：自动寻找对比度最高时对应的门宽，门宽扫描结果在门宽分析面板中:

![](https://s2.loli.net/2025/12/28/rFv1fp4nu9sIUbY.png)

典型处理结果如下：

![](https://s2.loli.net/2025/12/28/8dD31YywCASMKVI.png)

### SDVPNRL面板
CH1-CH4通道分别对应PNRL测量基，用户应遵循该定义进行数据采集。另外，使用此面板时，务必将CH12通道延时以及CH34通道延时进行手工大致对齐（延时可以在PNRL面板处理时得到；在大致对齐后，软件自身会进行细致微调）。
- 峰值稳定性：将Z基和X基数据进行叠加，以还原出真实强度态，并计算峰值变异系数
- 门宽内光子数：统计强度和偏振叠加后12种量子态的门宽计数和变异系数
- 对比度、误码率：包括峰值、门宽对比度和误码率的平均值

该面板还可以对强度、偏振态进行识别，强度态用不同延时标识，偏振态用PNRL字母标识。

典型处理结果如下：

![](https://s2.loli.net/2025/12/28/DwSu9U32KihefaR.png)

![](https://s2.loli.net/2025/12/28/aSuqJhgHBdt1FlG.png)

# PBB84scope_analysis
## 基本功能
用于进行偏振调制BB84量子光源的在线调试和采集，具有以下特性：
- 实用：可以4个通道同时观察，默认使用TDC1-4通道接超导电子学，TDC5通道接同步信号，符合实验习惯，省去复杂配置过程
- 在线对比度计算：可以选取单通道中两个脉冲的位置，进行对比度计算
- 即时数据处理：配备轻量化性能测试功能，在调试和采集的同时可以实现类似**PBB84analysis**的分析

## 用户输入参数
- Trigger Level：TDC触发阈值
- Dead Time：TDC死时间
- Aquisition time：采集时间
- bin width：TDC采样bin宽
- #bin：scope中显示以及save的bin数量
- Delay：将指定通道数据进行人为延时

另外，用户还可以自定义图像横坐标范围、纵坐标对数/线性显示以及上限。'save'案件可一键保存4通道数据，命名为CH1-xx.csv~CH4-xx.csv，和**PBB84analysis**兼容。

## 在线对比度计算功能
仅需在ER功能框中定义S、D、V脉冲的时间范围，即可显示出时间范围内的光子数，并计算S/D和S/V的对比度。该功能同样适用于偏振态采数计算。